@model HotelReservation.Models.Room

@{
    ViewData["Title"] = "Room Details";
}

<script>
    $(function () {
        var dateFormat = "dd-mm-yy";
        var today = new Date();

        var from = $("#from").datepicker({
            defaultDate: "+1w",
            changeMonth: true,
            numberOfMonths: 3,
            dateFormat: dateFormat,
            minDate: today,
            onSelect: function (selectedDate) {
                to.datepicker("option", "minDate", selectedDate);
            }
        });

        var to = $("#to").datepicker({
            defaultDate: "+1w",
            changeMonth: true,
            numberOfMonths: 3,
            dateFormat: dateFormat,
            minDate: today,
            onSelect: function (selectedDate) {
                from.datepicker("option", "maxDate", selectedDate);
            }
        });

        var roomId = @Model.RoomId;
        $.ajax({
            type: 'GET',
            url: '/Reservation/GetReservedDates',
            data: { roomId: roomId },
            success: function (reservedDates) {
                from.datepicker("option", "beforeShow", function (input, inst) {
                    return {
                        minDate: today, maxDate: to.datepicker("getDate"),
                        beforeShowDay: function (date) {
                            var stringDate = $.datepicker.formatDate(dateFormat, date);
                            return [reservedDates.indexOf(stringDate) == -1];
                        }
                    };
                });

                to.datepicker("option", "beforeShow", function (input, inst) {
                    return {
                        minDate: from.datepicker("getDate"), maxDate: today,
                        beforeShowDay: function (date) {
                            var stringDate = $.datepicker.formatDate(dateFormat, date);
                            return [reservedDates.indexOf(stringDate) == -1];
                        }
                    };
                });
            },
            error: function (error) {
                console.error(error);
            }
        });
    });
</script>

<h2>Room Details</h2>

<div class="container mt-4">
    <div class="row">
        <div class="col-md-6">
            <div id="carouselExampleControls" class="carousel slide" data-bs-ride="carousel">
                <div class="carousel-inner">
                    <div class="carousel-item active">
                        <img src="@Model.PictureUrl1" class="d-block w-100" alt="First Picture">
                    </div>
                    <div class="carousel-item">
                        <img src="@Model.PictureUrl2" class="d-block w-100" alt="Second Picture">
                    </div>
                    <div class="carousel-item">
                        <img src="@Model.PictureUrl3" class="d-block w-100" alt="Third Picture">
                    </div>
                </div>
                <button class="carousel-control-prev" type="button" data-bs-target="#carouselExampleControls" data-bs-slide="prev">
                    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                    <span class="visually-hidden">Previous</span>
                </button>
                <button class="carousel-control-next" type="button" data-bs-target="#carouselExampleControls" data-bs-slide="next">
                    <span class="carousel-control-next-icon" aria-hidden="true"></span>
                    <span class="visually-hidden">Next</span>
                </button>
            </div>
        </div>
        <div class="col-md-6">
            <div class="card">
                <div class="card-body">
                    <h5 class="card-title">Room @Model.RoomNumber</h5>
                    <p class="card-text">
                        Type: @Model.Type <br />
                        Description: @Model.Description <br />
                        Capacity: @Model.Capacity <br />
                        Price: @Model.Price <br />
                    </p>
                </div>
            </div>
            <h4>Amenities:</h4>
            <ul>
                @foreach (var amenity in Model.Amenities)
                {
                    <li>@Enum.GetName(typeof(HotelReservation.Models.Amenities), amenity)</li>
                }
            </ul>
            @if (User.Identity.IsAuthenticated)
            {
                <div class="mt-4">
                    <label for="from">From Date:</label>
                    <input type="text" id="from" name="from" min="@DateTime.Now.ToString("dd-MM-yyyy")">

                    <label for="to">To Date:</label>
                    <input type="text" id="to" name="to" min="@DateTime.Now.ToString("dd-MM-yyyy")">

                    <button id="reserveButton" class="btn btn-primary ml-4">Reserve Room</button>
                </div>
            }
        </div>
    </div>
</div>

<script>
    $(document).ready(function () {
        $('#reserveButton').on('click', function () {
            var from = $('#from').val();
            var to = $('#to').val();

            $.ajax({
                type: 'POST',
                url: '/Room/ReserveRoom',
                data: { roomId: @Model.RoomId, from: from, to: to },
                success: function (result) {
                    console.log(result);
                },
                error: function (error) {
                    console.error(error);
                }
            });
        });
    });
</script>
